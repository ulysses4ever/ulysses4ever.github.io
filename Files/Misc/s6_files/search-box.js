$(function(){var o=$(".search_box");var m=$(".search_box-q",o);var h=m.attr("invitation");var c=m.val();var e=$(".searchButton",this);m.val(c||h);m.focus(function(){if(m.val()==h){m.val(c)}});var s;m.blur(function(){if(s){return s=false}if(m.val()==""){m.val(c||h)}a()});var k,n=500,i,r=3,g=c,b,d;a();m.keyup(function(u){switch(u.keyCode){case 27:a();m.val(c);break;case 40:f(d.next()[0]||d[0]);return false;case 38:f(d.prev()[0]||d[0]);return false;case 13:j();return false;default:var t=$.trim(m.val());if(t.length>=r&&t!=g){l()}g=t}});m.keypress(function(t){return t.keyCode!=13});m.focus(l);e.click(function(){if((m.val()!=h)&&(m.val()!="")){j()}});function f(t,u){d.removeClass("active");d=$(t);d.addClass("active");u===false||m.val(d.data("word"));g=$.trim(m.val())}function j(){var t=d.length?d.data("word")||"":m.val();m.val(t);a();t&&m[0].form.submit()}var p={};function l(){a();var t=$.trim(m.val());if(!t){return}if(p[t]){q(p[t],t)}else{clearTimeout(i);i=setTimeout(function(){$.getJSON("/pgu/suggests",{request:t,resultCount:5},function(u){p[t]=u.suggests;
if($.trim(m.val())!=t){return}q(u.suggests,t)})},n)}}function q(u,w){u.sort(function(y,x){return(y.requestCount>=x.requestCount)?(y.requestCount==x.requestCount)?0:-1:1});a();u=$.map(u,function(x){return x.hint!=w?x:null});if(u.length){var v={hint:m.val()};u=[v].concat(u);k=$('<div class="suggest-list-wrapper"><div class="suggest-list-wrapper-center"><ul class="suggest-list"></ul></div><div class="suggest-list-wrapper-bottom"><div class="suggest-list-wrapper-bottom-inner"></div></div></div>').insertAfter(m).find("ul");var t=new RegExp("("+w.replace(/([\/|()*+?$^{}\[\].])/g,"\\$1")+")","i");$.each(u,function(y,x){$('<li class="suggest-list-item"><span class="suggest-list-item-text">'+x.hint.replace(t,"<b>$1</b>")+"</span></li>").appendTo(k).mouseover(function(z){f(this)}).mousedown(function(z){s=true}).click(j).data("word",x.hint)});b=k.find("li");f(b.eq(0).hide(),false);o.addClass("suggests-opened")}}function a(){m.nextAll().remove();k=$([]);b=$([]);d=$([]);o.removeClass("suggests-opened")
}});