(function(f){f.descriptor=f.descriptor||{};var c={};function b(l){if(l.attr("name")&&l.val()){c[l.attr("name")]=c[l.attr("name")]||l.val();l.val("").change();setTimeout(function(){l.parents("form").validate().element(l)},1)}}function d(m){var l=m.attr("name");if(c[l]){m.val(c[l]).change();delete c[l]}}f.descriptor.setFieldValForRestore=function(l,n,m){if(!m||c.hasOwnProperty(l)){c[l]=n}};f.descriptor.getFieldValForRestore=function(l){return c[l]};var e=f.descriptor.$select=function(s,m){var r=s.indexOf("[]");if(r!=-1){var p=s.substr(0,r+1);var q=s.substr(r+1);if(m==undefined){var n,l=0,o=f([]);while(n=document.getElementById(p+l+++q)){o=o.add(n)}return o}return f("*[id]",m).filter(function(){if(this.id.length>s.length&&this.id.indexOf(p)==0){var t=this.id.substr(r+1);var u=t.indexOf(q);if(u!=-1&&u+q.length==t.length){t=t.substr(0,u);return(/^(0|[1-9]\d*)/.test(t))}}})}return f(document.getElementById(s))};f.descriptor.waitingForProcess=0;f.descriptor.runProcess=null;f.descriptor.bind=function(o,n,m,l){var p=e(o).bind(n,m);
f.descriptor.bind.memory.push({sourceId:o,event:n,handler:m});if(l){p.each(function(){m.apply(this)})}};f.descriptor.bind.memory=[];f.descriptor.bind.init=function(l){f(f.descriptor.bind.memory).each(function(){var n=e(this.sourceId,l).bind(this.event,this.handler);var m=this.event;n.trigger(m)})};function g(l){return e(l)}function k(m){m=(typeof m=="string")?m:f(m).attr("name");var l=g(m);return l}function j(m,l){return h[m]&&h[m].options&&h[m].options[l]}var i;var h={};var a={init:function(l){if(l&&l.inputId){i=f("#"+l.inputId)}else{i=f("#fieldDescriptor")}f(this).bind("submit.descriptor",a.serialize);if(i.length>0&&i.val().length>0){h=f.parseJSON(i.val())}f(this).descriptor("process");f.descriptor.last=this;f.descriptor.runProcess=function(){f(f.descriptor.last).descriptor("process")}},process:function(){if(f.descriptor.waitingForProcess){var o=f(this);setTimeout(function(){o.descriptor("process")},10);return}if(!a.processRuntime){var o=f(this);a.processTask=a.processTask||setTimeout(function(){a.processRuntime=true;
a.processTask=0;o.descriptor("process")},1);return}a.processRuntime=false;a.wasVisibleChanged=false;if(!f.isEmptyObject(h)){for(var n in h){for(var l in h[n]){var m=h[n][l];var p=j(n,l);k(n).each(function(){var q=h[n];if(n!=f(this).attr("id")&&h[f(this).attr("id")]){var r=h[f(this).attr("id")];for(var s in r){if(s==="disabled"||s==="visible"){q[s]=r[s]}}}f(this).descriptor("_applyDescriptorAttribute",l,m,j(f(this).attr("name"),l)||p,q)});a.wasVisibleChanged|=(l=="visible")}}}if(a.wasVisibleChanged){f.clonable.checkButtonsVisibility()}},processTask:0,processRuntime:false,serialize:function(){i.val(f.toJSON(h));if(f(this).validate().valid()){this.submit();f("#submitBtn").unbind();return false}else{f("#shadowWrap").hide()}},setAttribute:function(m,n,o){var l=h[this.attr("name")]=h[this.attr("name")]||{};l[m]=n;if(o){l.options=l.options||{};l.options[m]=f.extend(true,l.options[m]||{},o)}this.descriptor("process")},addClass:function(l){if(!h[this.attr("name")]){h[this.attr("name")]={}}if(!h[this.attr("name")]["class"]){h[this.attr("name")]["class"]=[l]
}else{if(jQuery.inArray(l,h[this.attr("name")]["class"])==-1){h[this.attr("name")]["class"].push(l)}}this.descriptor("process")},removeClass:function(m){k(this).each(function(){var n=f(this);n.removeClass(m)});if(h[this.attr("name")]&&h[this.attr("name")]["class"]){var l=jQuery.inArray(m,h[this.attr("name")]["class"]);if(l!=-1){h[this.attr("name")]["class"].splice(l,1)}}},addValidation:function(m,l,n){function p(r){var q=o.data("rulesByValidation");if(!q){o.data("rulesByValidation",q={})}o.rules("add",r);q[m]=f.extend(q[m]||{},r)}var o;k(this).each(function(){o=f(this);var q={};if(n&&n.messages){q.messages=n.messages}if(l&&l.length){q[m]=l;switch(m){case"digitsexact":case"range":p(f.extend({digits:true},q));break;case"lengthexact":case"rangelength":case"invaluelist":case"min":case"max":case"minlength":case"maxlength":p(q);break;case"fractcount":p(f.extend({number:true},q));break;default:if(f.validator.methods[m]){o.rules("add",q)}break}}else{q[m]=true;o.rules("add",q)}o.descriptor("addClass",m)
});f(this).descriptor("addClass",m)},removeValidation:function(m){function l(){var o=(n.data("rulesByValidation")||{})[m];if(o){for(var p in o){n.rules("remove",p);delete o[p]}}else{n.rules("remove",m)}}var n;k(this).each(function(){n=f(this);l();n.descriptor("removeClass",m)});f(this).descriptor("removeClass",m);if(n&&n.hasClass("fielderror-invalidfield")){n.valid()}},_applyDescriptorAttribute:function(t,o,n,r){var s=f(this).data("applyDescriptorAttribute")||{};var p=("readonly"==t&&!s.readonly)?"disabled":t;var w=(typeof s[p]=="function")?s[p]:null;if(!this.hasClass("applyDescriptorNativeExclude")){var l=this.attr("name");switch(t){case"visible":if(w){if(!r.disabled||(r.disabled&&!c.hasOwnProperty(l))){o?d(this):b(this)}}else{var m=this.attr("id")||this.attr("name"),v=widgetsApiHelper.$visibilityScope(n.scope,{EL:this,LBL:f("label").filter(function(){return f(this).attr("for")==m}),ROW:this.is("tr")?this:this.parents("tr:first")});o?v.show():v.hide()}break;case"required":if(o&&!this.hasClass("required")){this.addClass("required")
}else{if(!o&&this.hasClass("required")){this.removeClass("required");if(this.hasClass("fielderror-invalidfield")){this.valid()}}}break;case"readonly":o?this.attr("readonly",true):this.attr("readonly",false);break;case"disabled":if(o){if(r.visible===undefined||r.visible||(r.visible===0&&!c.hasOwnProperty(l))){b(this)}this.attr("disabled",true)}else{if(this.attr("disabled")){this.attr("disabled",false);if((r.visible===undefined||r.visible)&&c.hasOwnProperty(l)){d(this)}}}break;case"class":for(var q=0;q<o.length;q++){var u=o[q];if(!this.hasClass(u)){this.addClass(u)}}break;default:this.attr(t,o)}}if(w){w.call(s,o,n)}},removeDescriptorAttribute:function(l){if(h[this.attr("name")]&&typeof h[this.attr("name")][l]!=="undefined"){delete h[this.attr("name")][l]}},descriptorToString:function(){return f.toJSON(h)}};f.fn.descriptor=function(l){if(!this.length){this.extend(jQuery("<div/>").attr("name",this.selector.substr(1)))}if(a[l]){return a[l].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof l==="object"||!l){return a.init.apply(this,arguments)
}else{f.error("Method "+l+" does not exist on jQuery.descriptor")}}return this}})(jQuery);Array.prototype.contains=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return true}}return false};